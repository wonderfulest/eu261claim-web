generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ShortLink {
  id           BigInt        @id @default(autoincrement())
  shortId      String        @unique(map: "short_id") @map("short_id") @db.VarChar(50)
  longUrl      String        @map("long_url") @db.VarChar(2048)
  createdAt    DateTime      @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt    DateTime?     @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  buttonClicks ButtonClick[]
  clickEvents  ClickEvent[]

  @@index([shortId], map: "idx_short_id")
  @@map("short_links")
}

model ClickEvent {
  id           BigInt        @id @default(autoincrement())
  shortId      String        @map("short_id") @db.VarChar(50)
  ipAddress    String?       @map("ip_address") @db.VarChar(45)
  userAgent    String?       @map("user_agent") @db.VarChar(512)
  referrer     String?       @db.VarChar(2048)
  utmSource    String?       @map("utm_source") @db.VarChar(100)
  utmMedium    String?       @map("utm_medium") @db.VarChar(100)
  utmCampaign  String?       @map("utm_campaign") @db.VarChar(100)
  utmContent   String?       @map("utm_content") @db.VarChar(100)
  utmTerm      String?       @map("utm_term") @db.VarChar(100)
  clickedAt    DateTime      @default(now()) @map("clicked_at") @db.DateTime(0)
  buttonClicks ButtonClick[]
  shortLink    ShortLink     @relation(fields: [shortId], references: [shortId], onDelete: Cascade, onUpdate: NoAction, map: "click_events_ibfk_1")

  @@index([clickedAt], map: "idx_clicked_at")
  @@index([shortId], map: "idx_short_id")
  @@index([utmSource, utmMedium], map: "idx_utm_source_medium")
  @@map("click_events")
}

model ButtonClick {
  id           BigInt      @id @default(autoincrement())
  clickEventId BigInt?     @map("click_event_id")
  shortId      String      @map("short_id") @db.VarChar(50)
  clickedAt    DateTime    @default(now()) @map("clicked_at") @db.DateTime(0)
  clickEvent   ClickEvent? @relation(fields: [clickEventId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "button_clicks_ibfk_1")
  shortLink    ShortLink   @relation(fields: [shortId], references: [shortId], onDelete: Cascade, onUpdate: NoAction, map: "button_clicks_ibfk_2")

  @@index([clickEventId], map: "idx_click_event_id")
  @@index([clickedAt], map: "idx_clicked_at")
  @@index([shortId], map: "idx_short_id")
  @@map("button_clicks")
}

model CompensableFlight {
  id                 BigInt    @id @default(autoincrement())
  flightNumber       String    @map("flight_number") @db.VarChar(20)
  airlineName        String    @map("airline_name") @db.VarChar(100)
  scheduledDeparture DateTime  @map("scheduled_departure") @db.DateTime(0)
  scheduledArrival   DateTime  @map("scheduled_arrival") @db.DateTime(0)
  actualDeparture    DateTime? @map("actual_departure") @db.DateTime(0)
  actualArrival      DateTime? @map("actual_arrival") @db.DateTime(0)
  isActive           Boolean   @default(true) @map("is_active")
  createdAt          DateTime  @map("created_at") @db.DateTime(0)
  updatedAt          DateTime  @map("updated_at") @db.DateTime(0)

  @@index([flightNumber], map: "idx_flight_number")
  @@index([scheduledDeparture], map: "idx_scheduled_departure")
  @@map("compensable_flights")
}
